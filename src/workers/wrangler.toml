# Queue Consumer Worker Configuration
# This worker processes file chunks from the file-processing queue.
# Deploy separately from the Pages app.

name = "finops-queue-consumer"
main = "queue-consumer.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# R2 Storage for file uploads (same bucket as Pages app)
[[r2_buckets]]
binding = "UPLOADS_BUCKET"
bucket_name = "finops-uploads"

# Queue consumer configuration
[[queues.consumers]]
queue = "file-processing"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "file-processing-dlq"

# KV namespace for job status tracking (same namespace as Pages app)
[[kv_namespaces]]
binding = "JOB_STATUS"
id = "1bfcac9914fc4b70a08f958b9401a16f"

# Environment variables (set via wrangler secret)
# DATABASE_URL - Neon connection string
# VALIDATOR_URL - Railway validator URL
